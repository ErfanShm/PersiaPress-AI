# 📄 PersiaPress AI

Automate your WordPress workflow: Generate Persian blog posts from English sources using AI and publish drafts instantly.

## 🌟 Project Overview

The PersiaPress AI project is a Streamlit-based web application designed to automate and streamline the creation of Persian blog content for WordPress from English source material.

**Main Purpose & Problem Solved:**
The primary goal of PersiaPress AI is to simplify and accelerate the process of generating engaging Persian blog posts for the `hooshews.com` WordPress site. It addresses the challenge of manually translating, adapting, and optimizing content for a Persian audience, a task that can be time-consuming and require significant effort. It also aims to enhance collaboration among content creators by providing a centralized platform with cloud-synchronized outputs.

**Key Features & Functionalities (High-Level):**
*   **AI-Powered Content Generation:** Leverages Large Language Models (LLMs) to generate a comprehensive package from English source articles. This includes a Persian blog post (translated and SEO-optimized), title, slug, meta description, image alt text, focus keywords, and tags. It also generates social media content like Instagram posts/stories and image prompts.
*   **WordPress Integration:** Directly interacts with the WordPress REST API to automate the creation of draft posts. This includes uploading featured images and managing tags.
*   **Dual Save & Load Capabilities:**
    *   **Local Storage:** Saves all generated content as JSON files in a local `answers/` directory.
    *   **Pantry Cloud Integration:** Optionally saves and loads content to/from Pantry Cloud, enabling easy sharing and access across a team. These cloud operations are performed asynchronously.
*   **Collaboration Support:** Generated files and Pantry Cloud basket names are prefixed with the user's WordPress username (`WP_USERNAME`), making it easier to identify and manage content in a team environment.
*   **User-Friendly Web Interface:** Utilizes Streamlit to provide an interactive interface for inputting source article details, uploading images, initiating content generation, loading previous work, and publishing to WordPress.
*   **Content Processing:** Includes features like converting generated Markdown content to HTML for WordPress compatibility.

**Target User:**
The application is targeted towards content creators, bloggers, digital marketers, or editorial teams who manage a Persian-language WordPress website and wish to efficiently repurpose English content using AI. The features facilitating team collaboration (cloud storage, username prefixing) imply its suitability for small to medium-sized content teams.

---

## 🗂️ File Structure

```
.
├── .env                       # Environment variables (manually filled by user)
├── .env.tmp                   # Template for environment variables
├── .gitignore                 # Specifies files/directories to be ignored by Git
├── pyproject.toml             # Project metadata and dependencies (managed by uv)
├── uv.lock                    # Locked dependency versions for reproducible builds (generated by uv)
├── README.md                  # Project overview and documentation
├── run.bat                    # Windows batch script to launch the Streamlit application
├── answers/                   # Stores AI-generated content outputs (JSON files)
├── app/                       # Main application package
│   ├── __init__.py            # Initializes the Python package
│   ├── app.py                 # Main entry point for the Streamlit web application
│   ├── ui.py                  # Defines the Streamlit user interface components
│   ├── content_generator.py   # Logic for AI-driven content generation
│   ├── llm_clients.py         # Manages LLM client initialization and configuration
│   ├── wordpress_handler.py   # Handles interactions with the WordPress REST API
│   ├── file_utils.py          # Utility functions for file operations and data persistence
│   ├── utils.py               # Miscellaneous helper functions
│   └── prompts/               # Directory for LLM prompt templates (text files)
│       ├── system_prompt_blog_generation.txt
│       ├── human_prompt_blog_generation.txt
│       ├── blog_thumbnail_image_prompt.txt
│       ├── instagram_static_image_prompt.txt
│       ├── instagram_video_ready_image_prompt.txt
│       ├── instagram_video_prompt.txt
│       ├── system_prompt_instagram_texts.txt
│       ├── human_prompt_instagram_texts.txt
│       ├── system_prompt_analyze_blog.txt
│       ├── human_prompt_analyze_blog.txt
│       ├── system_prompt_instagram_story_teasers.txt
│       └── human_prompt_instagram_story_teasers.txt
├── images/                    # Stores temporary thumbnail images uploaded by the user
└── plugins/                   # Contains WordPress plugins
    └── Rank-Math-Api-Manager/ # Custom plugin for Rank Math SEO API integration
        └── rank-math-api-manager-extended-v1.3.php
```

---

## 🚀 Features

*   **Source Input:** Accepts English source article title, body, source name, and URL.
*   **LLM Content Package Generation:** Generates Persian Title, English Slug, Persian Content (Markdown), Meta Description, Alt Text, Focus Keywords, SEO Title, English/Persian Tags, Instagram Post/Story content, and Image Prompts.
*   **Dual Data Persistence & Loading:**
    *   Saves all generated data (including raw LLM outputs and final package) to local JSON files in `answers/`.
    *   Optionally saves the same data to Pantry Cloud if `PANTRY_ID` is configured.
    *   Filenames and Pantry basket names are prefixed with the `WP_USERNAME` for team traceability.
    *   Allows loading data from local files via `st.file_uploader`.
    *   Allows fetching a list of baskets from Pantry Cloud and loading selected data.
*   **Asynchronous Pantry Operations:** All interactions with Pantry Cloud (saving, listing baskets, getting basket content) are performed asynchronously using `aiohttp`.
*   **WordPress Post Creation Workflow:** (As previously described, including Markdown to HTML, tag handling, image upload, Rank Math attempt).
*   **Local Image Handling:** (As previously described).

---

## 🔄 Application Workflow

The PersiaPress AI application follows a user-driven workflow, orchestrated by the Streamlit interface defined in `app/ui.py`.

**1. Initialization and LLM Client Setup:**
*   When the user launches the application (`streamlit run app/app.py`), the `main()` function in `app/ui.py` is executed.
*   It first checks for the `GOOGLE_API_KEY` environment variable. If not found, it displays an error and stops.
*   It then calls `initialize_llm_clients()` from `app/llm_clients.py` to set up the necessary Large Language Model clients. If this fails, an error is displayed.

**2. User Input for New Content Generation:**
*   The UI presents input fields for the English source title, body, source name, and URL.
*   Checkboxes allow the user to select optional content like Instagram texts, story teasers, and an Iranian Farsi video prompt.

**3. (Optional) Loading Previous Work:**
   Users can load previously generated content:
*   **Local File Upload:** Via `st.file_uploader` for JSON files from the `answers/` folder.
*   **Pantry Cloud Loading:** If `PANTRY_ID` is configured, users can fetch and select baskets from Pantry Cloud.

**4. Content Generation Process:**
*   Clicking "✨ Generate Persian Blog Post Package" triggers `generate_persian_blog_package()` from `app/content_generator.py`.
*   This function uses the initialized LLM clients and source details to produce the Persian blog package, SEO metadata, image prompts, etc.
*   **Data Saving (Automatic):** The generated output is saved locally (to `answers/`) and to Pantry Cloud (if configured) by functions in `app/file_utils.py`.

**5. Displaying Generated/Loaded Content:**
*   The UI presents the generated or loaded data in expandable sections (Metadata, Blog Content, Image Prompts, Instagram Content, etc.).

**6. Thumbnail Image Upload (Blog):**
*   Users can upload a thumbnail image, which is saved locally to the `images/` directory in WEBP format.

**7. Publishing to WordPress:**
*   Clicking "Create Draft Post in WordPress" calls `create_draft_post()` from `app/wordpress_handler.py`.
*   This function sends the title, content, slug, tags, SEO metadata, and the locally saved image (if found) to the WordPress REST API to create a draft post.

---

## 📋 Requirements

1.  **Software:**
    *   Python 3.11
    *   `uv` package manager (recommended)
    *   WordPress site with REST API & Application Password.
    *   OpenAI-compatible API access.
    *   (Optional) Custom Rank Math API plugin.
2.  **Environment Setup:**
    *   Create a `.env` file in the project root.
    *   Populate it with:

    ```env
    # LLM Configuration
    GOOGLE_API_KEY=your_google_api_key_for_avalai 
    BLOG_MODEL_NAME=choose_your_blog_model
    IMAGE_PROMPT_MODEL_NAME=choose_your_image_prompt_model
    INSTAGRAM_TEXT_MODEL_NAME=choose_your_instagram_text_model

    # WordPress Configuration
    WP_URL=your_wordpress_site_url
    WP_USERNAME=your_wordpress_username
    WP_APP_PASSWORD=your_wordpress_application_password

    # Pantry Cloud (Optional)
    # PANTRY_ID=your_pantry_cloud_id 
    ```
    _Ensure `WP_USERNAME` is set for file/basket naming. If `PANTRY_ID` is provided, cloud features are enabled._

---

## 💻 Installation & Launch Instructions

1.  **Clone Repository**
2.  **Install Dependencies** (Using `uv sync`)
    ```bash
    uv sync
    ```
3.  **Configure Environment** (Create and populate `.env` as described above).
4.  **Launch Application**
    ```bash
    streamlit run app/app.py
    ```
    (Or use `run.bat` on Windows).

---

## 📝 Usage Guide

1.  Launch and access the Streamlit app.
2.  **Input Source:** Fill in English article details.
3.  **Generate Content:** Click "✨ Generate Persian Blog Post Package".
    *   Optionally select/deselect checkboxes for Instagram post/story generation.
4.  **Review Output:** Examine generated content. Outputs are automatically saved locally and to Pantry if configured.
5.  **Upload Thumbnail:** Use the image uploader.
6.  **(Optional) Load Existing Output:**
    *   **Local:** Use the "Upload a previously generated .json file".
    *   **Pantry Cloud:** If configured, use the "Load from Pantry Cloud" section.
7.  **Create WordPress Draft:** Click "🚀 Create Draft Post in WordPress".
8.  **Verify:** Check WordPress admin.

---

## ⚙️ Technical Implementation Details

### LLM Usage
*   Uses `langchain-openai`'s `ChatOpenAI` client via `app.llm_clients`.
*   Content generation is orchestrated in `app.content_generator` with detailed prompts.

### WordPress Interaction (`requests`)
*   Managed by `app.wordpress_handler`.
*   Uses `requests` for synchronous communication with WordPress REST API.

### Data Persistence & Cloud Sync (`app.file_utils`, `aiohttp`)
*   `app.file_utils` contains logic for data handling.
*   Local saves: JSON files to `answers/`, prefixed with sanitized `WP_USERNAME`.
*   Pantry Cloud: If `PANTRY_ID` is set, saves to Pantry using `aiohttp` for asynchronous `POST` requests. Basket names are also prefixed with username.
*   Pantry Loading: Lists baskets and fetches content asynchronously using `aiohttp`.

### UI (`streamlit`)
*   Managed by `app.ui` and `app.app`.
*   Uses `asyncio.run` to integrate asynchronous Pantry loading functions into Streamlit's synchronous flow.

### File Handling & Logging
*   Standard Python libraries (`os`, `dotenv`, `logging`, `markdown`, `Pillow`, `mimetypes`).

---

## 📈 Current Status & Future Plans

### Current Status
*   Core workflow functional: LLM generation, local/Pantry saving (with username prefix), loading from local/Pantry, WordPress draft creation.
*   Pantry operations are asynchronous.
*   Rank Math API integration remains potentially unreliable.
*   Non-ASCII tag creation via API is disabled.

### Future Enhancements
*   Resolving network/SSL errors for WordPress.
*   Improving Rank Math integration.
*   Solution for non-ASCII tags.
*   More robust error handling.
*   Internal linking.
*   Testing.

---
